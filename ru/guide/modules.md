---
title: Модули
description: Модули - это расширения для Nuxt.js, которые могут менять функционал фреймворка и добавлять различные интеграции.
---

> Модули - это расширения для Nuxt.js, которые могут улучшать базовый функционал фреймворка и добавлять различные интеграции.

## Вступление

В процессе разработки боевых приложений с фреймворком Nuxt, вы вскоре обнаружите, что вам не хватает базовой функциональности фреймворка. Nuxt может быть расширен с помощью настроек конфигурации и плагинов, однако поддержка этих изменений в нескольких проектах утомительна, скучна и занимает много времени. С другой стороны, поддержание требований каждого проекта "из коробки" сделало бы Nuxt очень сложным и тяжёлым в использовании.

Это одна из причин, по которой Nuxt предоставляет модульную систему более высокого порядка, которая позволяет с легкостью расширять ядро. Модули - это просто **функции**, которые вызываются поочерёдно во время загрузки Nuxt. Фреймворк ждёт окончания работы каждого модуля перед тем как продолжить. Таким образом, модули могут изменять практически любую сторону Nuxt. Благодаря модульной архитекуре Nuxt (которая основана на библиотеке от webpack [Tapable](https://github.com/webpack/tapable)), модули могут без проблем регистрировать хуки для определенных входных точек, например, для инициализации сборщика. Модули так же могут переопределять шаблоны, настраивать загрузчики для webpack, добавлять CSS-библиотеки и выполнять много других полезных задач.

Самое лучше - модули Nuxt могут быть встроены в npm пакеты. Это значит, что их легко переиспользовать между проектами, а так же делиться ими с сообществом, создавая экосистему из качественных расширений для Nuxt.

Модули отлично вам подходят, если вы:

- Являетесь членом **гибкой команды**, которой нужно быстро запускать новые проекты.
- Устали **переизобретать** колесо для частых задач, таких как интеграция Google Analytics.
- Являетесь очаровательным энтузиастом **Open Source**, который бы хотел **поделиться** своей работой с сообществом.
- Являетесь членом **Enterprise** компании, который ценит **качество** и **переиспользуемость**.
- Часто сталкиваетесь со сжатыми сроками, и у вас нет времени залезать в дебри каждой новой библиотки или интеграции
- Устали разбираться с критическими изменениями в каждой библиотеке и хотите чтобы всё **просто работало™**.

## Список модулей Nuxt.js

Команда Nuxt.js предлагает **официальные** модули:
- [@nuxt/http](https://http.nuxtjs.org): Простой и универсальный способ делать HTTP-запросы, основанный на библиотеке [ky-universal](https://github.com/sindresorhus/ky-universal)
- [@nuxt/content](https://content.nuxtjs.org): Пишите в директории `content/` и получайте свои файлы Markdown, JSON, YAML и CSV с помощью API, похожего на MongoDB
- [@nuxtjs/axios](https://axios.nuxtjs.org): Безопасная и простая интеграция библиотеки Axios с Nuxt.js для совершения HTTP-запросов
- [@nuxtjs/pwa](https://pwa.nuxtjs.org): Разгоните Nuxt с помощью отлично протестированного, обновляемого и стабильного решения  для PWA
- [@nuxtjs/auth](https://auth.nuxtjs.org): Авторизационный модуль для Nuxt.js, который предлагает различные схемы и стратегии

Список модулей Nuxt.js, которые сделаны сообществом, доступен тут: https://awesomejs.dev/for/nuxt/ и тут: https://github.com/topics/nuxt-module

## Создание простого модуля

Как было сказано раньше, модули - это просто функции. Они могут быть упакованы в npm-пакет или напрямую включены в исходный код проекта.

**modules/simple.js**

```js
export default function SimpleModule (moduleOptions) {
  // Здесь будет ваш код
}

// ОБЯЗАТЕЛЬНО, если вы хотите публиковать ваш модуль на NPM
// module.exports.meta = require('./package.json')
```

**`moduleOptions`**

Это объект, который передаётся пользователем при настройке массива `modules`. Мы можем его использовать, чтобы настраивать поведение модуля.

**`this.options`**

Вы можете получить прямой доступ к настройкам Nuxt с помощью этой ссылки. Там находится всё содержимое пользовательского `nuxt.config.js` с заполненными полями по-умолчанию. Они могут быть использованы, чтобы пользоваться одними настройками в нескольких модулях.

**`this.nuxt`**

Это ссылка на активный экземпляр объекта Nuxt. Смотрите [документацию класса Nuxt для списка доступных методов](/api/internals-nuxt).

**`this`**

Контекст модулей. Смотрите документацию класса [ModuleContainer](/api/internals-module-container) для списка доступных методов.

**`module.exports.meta`**

Эта строка **необходима**, если вы публикуете модуль как npm-пакет. Внутри Nuxt использует метаданные, чтобы лучше работать с вашим пакетом.

**nuxt.config.js**

```js
export default {
  modules: [
    // Простое использование
    '~/modules/simple'

    // Передача параметров напрямую
      ['~/modules/simple', { token: '123' }]
  ]
}
```

Затем мы указываем Nuxt, что нужно загрузить конкретные модули для проекта с опциональными параметрами в качестве опций. Смотрите документацию [по настройке модулей](/api/configuration-modules) для остальной информации!

## Асинхронные Модули

Не все модули будут делать всё синхронно, Например, вы можете разработать модуль, который будет получать данные из API или делать асинхронный ввод-вывод. Для этого Nuxt поддерживает модули, которые могут возвращать Promise или вызывать callback-функцию.

## Модули, используемые только на шаге сборки

Обычно модули нужны только во время разработки и сборки. Использование `buildModules` (модулей, используемых только на шаге сборки) позволяет ускорить загрузку в боевом окружении, при этом существенно сокращая размер директории `node_modules` для боевых развёртываний. Если вы - автор модулей, то рекомендуется предлагать пользователям устанавливать ваш пакет в качестве `devDependency` и использовать `buildModules` вместо `modules` в `nuxt.config.js`.

Ваш модуль используется только на шаге сборки, если:
- Он не предоставляет серверную промежуточную обработку (`serverMiddleware`)
- Ему не нужно регистрировать хук, запускаемый при старте (как, например, sentry)
- Он не влияет на поведение `vue-renderer` или использует хук из пространств имён `server:` или `vue-renderer:`
- Делает что-то ещё, что не входит в область ответственности webpack (Подсказка: плагины и шаблоны компилируются и входят в зону ответственности webpack)

<div class="Alert Alert--orange">

<b>ЗАМЕЧАНИЕ:</b> Если вы будете предлагать использовать <code>buildModules</code> то укажите, пожалуйста, что этот функционал доступен в Nuxt начиная с версии <b>v2.9</b>. Пользователи старых версий Nuxt должны обновиться, или использовать вместо этого секцию <code>modules</code>.

</div>

### Используйте async/await

```js
import fse from 'fs-extra'

export default async function asyncModule () {
  // Тут можно делать асинхронные действия используя async/await
  const pages = await fse.readJson('./pages.json')
}
```

### Возвращайте Promise

```js
import axios from 'axios'

export default function asyncModule () {
  return axios.get('https://jsonplaceholder.typicode.com/users')
    .then(res => res.data.map(user => '/users/' + user.username))
    .then((routes) => {
      // Тут можно поменять пути, сгенерированные Nuxt
    })
}
```

## Распространённые отрывки кода

### Настройки на верхнем уровне

Иногда более удобно использовать верхнеуровневые опции при регистрации модулей в `nuxt.config.js`. Это позволяет нам совмещать несколько источников для опций.

**nuxt.config.js**

```js
export default {
  modules: [
    ['@nuxtjs/axios', { anotherOption: true }]
  ],

  // модуль axios знает про эти опции с помощью `this.options.axios`
  axios: {
    option1,
    option2
  }
}
```

**module.js**

```js
export default function (moduleOptions) {
  // `options` Будет содержать все три: option1, option2 и anotherOption
  const options = Object.assign({}, this.options.axios, moduleOptions)

  // ...
}
```

### Предоставление плагинов

Распространённой практикой для модулей является предоставление одного или нескольких плагинов при добавлении. Например, модуль [bootstrap-vue](https://bootstrap-vue.js.org) потребовал бы регистрацию себя во Vue. Для таких ситуаций мы можем использовать вспомогательную функцию `this.addPlugin`.

**plugin.js**

```js
import Vue from 'vue'
import BootstrapVue from 'bootstrap-vue/dist/bootstrap-vue.esm'

Vue.use(BootstrapVue)
```

**module.js**

```js
import path from 'path'

export default function nuxtBootstrapVue (moduleOptions) {
  // Регистрируем `plugin.js`
  this.addPlugin(path.resolve(__dirname, 'plugin.js'))
}
```

### Плагины-шаблоны

Регистрируемые плагины и шаблоны могут использовать [шаблоны lodash](https://lodash.com/docs/4.17.4#template) чтобы изменять своё содержимое в зависимости от опций.

**plugin.js**

```js
// Установить идентификатор для Google Analytics
ga('create', '<%= options.ua %>', 'auto')

<% if (options.debug) { %>
// Код, доступный только в режиме разработки
<% } %>
```

**module.js**

```js
import path from 'path'

export default function nuxtBootstrapVue (moduleOptions) {
  // Регистрируем шаблон `plugin.js`
  this.addPlugin({
    src: path.resolve(__dirname, 'plugin.js'),
    options: {
      // Nuxt подменит `options.ua` на `123` при копировании плагина в проект
      ua: 123,

      // Условные части кода, которые доступны только при разработке, будут вырезаны из боевой сборки
      debug: this.options.dev
    }
  })
}
```

### Добавление библиотеки CSS

Если ваш модуль предоставляет CSS-библиотеку, то удостоверьтесь, что вы проверили, не добавил ли уже пользователь ту же библиотеку чтобы избежать дубликатов, а так же добавьте **опцию, которая отключит** CSS-библиотеку в модуле.

**module.js**

```js
export default function (moduleOptions) {
  if (moduleOptions.fontAwesome !== false) {
    // Добавляем Font Awesome
    this.options.css.push('font-awesome/css/font-awesome.css')
  }
}
```

### Добавление ресурcов

<!-- todo: up2date? -->

Мы можем регистрировать плагины для webpack, чтобы добавлять ресурсы в процессе сборки.

**module.js**

```js
export default function (moduleOptions) {
  const info = 'Собрано отличным модулем - 1.3 альфа от ' + Date.now()

  this.options.build.plugins.push({
    apply (compiler) {
      compiler.plugin('emit', (compilation, cb) => {
        // Это создаст файл `.nuxt/dist/info.txt` с содержимым переменной `info`.
        // Источник так же может являться буфером
        compilation.assets['info.txt'] = { source: () => info, size: () => info.length }

        cb()
      })
    }
  })
}
```

### Register custom webpack loaders

Мы можем делать то же действие, что и `build.extend` в `nuxt.config.js`, при помощи `this.extendBuild`.

**module.js**

```js
export default function (moduleOptions) {
    this.extendBuild((config, { isClient, isServer }) => {
      // Загрузчик `.foo`
      config.module.rules.push({
        test: /\.foo$/,
        use: [...]
      })

      // Настройка созданных загрузчиков
      // Для внутренностей Nuxt смотрите исходный код:
      // https://github.com/nuxt/nuxt.js/tree/dev/packages/builder/src/webpack/base.js
      const barLoader = config.module.rules.find(rule => rule.loader === 'bar-loader')
  })
}
```

## Запускайте задачи на конкретные хуки

Вашему модулю может потребоваться делать какие-то действия только при каких-то условиях, а не просто во время инициализации Nuxt. Мы можем использовать мощную систему хуков Nuxt.js чтобы реагировать на какие-либо события (основано на [Hable](https://github.com/jsless/hable)).
Nuxt дождётся исполнения вашей функции, если она возвращает Promise или помечена как `async`.

Here are some basic examples:

```js
export default function myModule () {
  this.nuxt.hook('modules:done', (moduleContainer) => {
    // Это будет вызвано, когда все модули будут загружены
  })

  this.nuxt.hook('render:before', (renderer) => {
    // Это будет вызвано перед инициализацией отрисовывающего класса
  })

  this.nuxt.hook('build:compile', async ({ name, compiler }) => {
    // Это будет вызвано перед запуском компилятора (по-умолчанию, webpack)
  })

  this.nuxt.hook('generate:before', async (generator) => {
    // Это будет вызвано перед генерацией страниц
  })
}
```

## Команды для Nuxt

**Эксперементальная поддержка**

Начиная с версии `v2.4.0`, вы можете добавлять консольные команды для nuxt с помощью модулей. Для этого нужно воспользоваться API  `NuxtCommand` для создания команды. Простой пример, гипотетически размещаемый в `my-module/bin/command.js` может выглядеть так:

```js
#!/usr/bin/env node

const consola = require('consola')
const { NuxtCommand } = require('@nuxt/cli')

NuxtCommand.run({
  name: 'command',
  description: 'Команда моего модуля',
  usage: 'command <foobar>',
  options: {
    foobar: {
      alias: 'fb',
      type: 'string',
      description: 'Simple test string'
    }
  },
  run (cmd) {
    consola.info(cmd.argv)
  }
})
```

Тут следует отметить несколько вещей. Во-первых, обратите внимание на вызов `/usr/bin/env` для получения исполняемого файла Node. Так же обратите внимание, что синтаксис ES-модулей не может быть использован для команд, только если вы не добавите модуль [`esm`](https://github.com/standard-things/esm) в ваш код вручную.

Затем, обратите внимание, что `NuxtCommand.run()` используется для указания настроек и поведения команды. Опции задаются в параметре `options`; они будут разобраны библиотекой [`minimist`](https://github.com/substack/minimist). После того, как аргументы функции были разобраны, функция `run()` вызывается с экземпляром `NuxtCommand` в качестве первого параметра.

В примере выше, `cmd.argv` используется для получения разобранных аргументов командной строки. У `NuxtCommand` есть и другие методы и свойства -- документация по ним будет появляться по мере того, как этот функционал будет тестироваться и улучшаться.

Чтобы ваша команда была доступна в Nuxt CLI, добавьте её в секцию `bin` вашего `package.json`, используя соглашение `nuxt-module` , согласно которому `module` согласуется с названием вашего npm-пакета. Используя этот файл в качестве входной точки, вы можете использовать `argv` чтобы разобрать "подкоманды" для вашей команды, если вы этого захотите.

```js
{
  "bin": {
    "nuxt-foobar": "./bin/command.js"
  }
}
```

Когда ваш пакет установлен (с помощью NPM или Yarn), вы сможете исполнять `nuxt foobar ...` в командной строке.

<div class="Alert">

Существует куда больше хуков и возможностей для модулей. Пожалуйста, прочитайте секцию [Внутренности Nuxt](/api/internals) чтобы узнать больше об API `nuxt-internal`

</div>
